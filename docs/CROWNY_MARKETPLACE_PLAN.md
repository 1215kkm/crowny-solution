# CROWNY 코인 마켓플레이스 기획서

**버전**: 1.0
**작성일**: 2026년 2월 3일
**프로젝트명**: CROWNY Coin Marketplace

---

## 목차

1. [프로젝트 개요](#1-프로젝트-개요)
2. [회원 등급 시스템](#2-회원-등급-시스템)
3. [권한 부여 시스템](#3-권한-부여-시스템)
4. [수수료 분배 시스템](#4-수수료-분배-시스템)
5. [지갑 시스템](#5-지갑-시스템)
6. [마켓플레이스 기능](#6-마켓플레이스-기능)
7. [데이터베이스 설계](#7-데이터베이스-설계)
8. [화면 설계](#8-화면-설계)
9. [API 설계](#9-api-설계)
10. [글로벌 운영 전략](#10-글로벌-운영-전략)
11. [기술 스택](#11-기술-스택)
12. [구현 로드맵](#12-구현-로드맵)
13. [보안 고려사항](#13-보안-고려사항)

---

## 1. 프로젝트 개요

### 1.1 서비스 소개

CROWNY 코인 마켓플레이스는 **CROWNY 코인**을 기반으로 한 글로벌 P2P 거래 플랫폼입니다.
중고나라, 당근마켓과 같이 누구나 상품을 등록하고 거래할 수 있으며,
다단계 회원 등급 시스템을 통해 상위 회원이 하위 회원에게 권한을 부여하고
거래 수수료가 상위 라인으로 분배되는 구조입니다.

### 1.2 핵심 특징

| 특징 | 설명 |
|-----|------|
| **CROWNY 코인 거래** | 모든 거래는 CROWNY 코인으로 진행 |
| **6단계 회원 등급** | SUPER_ADMIN → CROWN → DIAMOND → GOLD → SILVER → BRONZE |
| **다단계 수수료 분배** | 거래 발생 시 상위 라인으로 수수료 자동 분배 |
| **에스크로 시스템** | 안전한 거래를 위한 에스크로 결제 |
| **글로벌 서비스** | 153개국 전 세계 사용자 지원 |

### 1.3 플랫폼 전략

| 플랫폼 | 우선순위 | 기술 |
|--------|---------|------|
| **모바일 앱** | 1순위 (메인) | React Native / Expo |
| **모바일 웹** | 2순위 | Next.js (반응형) |
| **PC 웹** | 3순위 | Next.js (반응형) |

---

## 2. 회원 등급 시스템

### 2.1 등급 구조 (6단계)

```
┌─────────────────────────────────────────────────────────────┐
│                  L0. SUPER_ADMIN (슈퍼관리자)                │
│                                                             │
│  - 시스템 최고 권한                                          │
│  - 모든 CROWN 임명/해임                                      │
│  - 전체 시스템 설정 관리                                      │
│  - 수수료 정책 결정                                          │
│  - 수수료 배분: 0.5%                                         │
├─────────────────────────────────────────────────────────────┤
│                     L1. CROWN (크라운)                       │
│                                                             │
│  - 국가/지역 최상위 관리자                                    │
│  - DIAMOND 임명/해임                                         │
│  - 국가별 정책 관리                                          │
│  - 수수료 배분: 1.5%                                         │
├─────────────────────────────────────────────────────────────┤
│                   L2. DIAMOND (다이아몬드)                    │
│                                                             │
│  - 지역/카테고리 총괄 관리자                                  │
│  - GOLD 임명/해임                                            │
│  - 산하 회원 관리                                            │
│  - 수수료 배분: 1.0%                                         │
├─────────────────────────────────────────────────────────────┤
│                      L3. GOLD (골드)                         │
│                                                             │
│  - 중간 관리자                                               │
│  - SILVER 승인/관리                                          │
│  - 판매자 심사                                               │
│  - 수수료 배분: 0.75%                                        │
├─────────────────────────────────────────────────────────────┤
│                     L4. SILVER (실버)                        │
│                                                             │
│  - 일반 판매자 (승인된 회원)                                  │
│  - 상품 등록/판매 가능                                        │
│  - BRONZE 초대 가능                                          │
│  - 수수료 배분: 0.25%                                        │
├─────────────────────────────────────────────────────────────┤
│                     L5. BRONZE (브론즈)                       │
│                                                             │
│  - 신규 가입자/구매자                                         │
│  - 구매만 가능                                               │
│  - 판매하려면 SILVER 승인 필요                                │
│  - 수수료 배분: 0%                                           │
└─────────────────────────────────────────────────────────────┘
```

### 2.2 등급별 권한 요약

| 등급 | 상품등록 | 구매 | 하위임명 | 수수료 | 관리범위 |
|-----|---------|-----|---------|-------|---------|
| SUPER_ADMIN | O | O | CROWN | 0.5% | 전체 시스템 |
| CROWN | O | O | DIAMOND | 1.5% | 국가/지역 |
| DIAMOND | O | O | GOLD | 1.0% | 지역/카테고리 |
| GOLD | O | O | SILVER | 0.75% | 판매자 그룹 |
| SILVER | O | O | BRONZE 초대 | 0.25% | 본인 |
| BRONZE | X | O | X | 0% | 본인 |

---

## 3. 권한 부여 시스템

### 3.1 권한 부여 흐름

```
SUPER_ADMIN
    │
    ├──→ CROWN 임명 (국가별)
    │        │
    │        ├──→ DIAMOND 임명
    │        │        │
    │        │        ├──→ GOLD 임명
    │        │        │        │
    │        │        │        ├──→ SILVER 승인
    │        │        │        │        │
    │        │        │        │        └──→ BRONZE 초대
    │        │        │        │
    │        │        │        └── (SILVER 관리)
    │        │        │
    │        │        └── (GOLD 관리)
    │        │
    │        └── (DIAMOND 관리)
    │
    └── (CROWN 관리)
```

### 3.2 권한 부여 규칙

1. **상위 → 하위만 가능**: 자신보다 정확히 한 단계 아래 등급만 부여 가능
2. **산하 관계 유지**: 권한 부여 시 추천인-피추천인 관계 자동 형성
3. **권한 회수**: 상위자는 자신이 부여한 권한 회수 가능
4. **권한 승계**: 상위자 탈퇴 시 그 상위자에게 산하 회원 승계

### 3.3 등급 승급 조건

| 현재 등급 | 승급 조건 | 승급 등급 |
|----------|---------|----------|
| BRONZE | 상위자(GOLD+) 승인 | SILVER |
| SILVER | 거래 실적 + 상위자(DIAMOND+) 승인 | GOLD |
| GOLD | 관리 실적 + 상위자(CROWN+) 승인 | DIAMOND |
| DIAMOND | 지역 실적 + SUPER_ADMIN 승인 | CROWN |
| CROWN | SUPER_ADMIN 직접 임명만 가능 | - |

---

## 4. 수수료 분배 시스템

### 4.1 수수료 구조

**총 거래 수수료: 4%**

| 등급 | 수수료율 | 역할 |
|-----|---------|------|
| SUPER_ADMIN | 0.5% | 시스템 운영비 |
| CROWN | 1.5% | 국가 관리 |
| DIAMOND | 1.0% | 지역 관리 |
| GOLD | 0.75% | 판매자 관리 |
| SILVER | 0.25% | 추천 보상 |
| **합계** | **4.0%** | |

### 4.2 수수료 분배 예시

**거래 금액: 10,000 CROWNY 상품 판매 시**

```
┌────────────────────────────────────────────────────────┐
│  거래 금액: 10,000 CROWNY                              │
│  총 수수료: 4% = 400 CROWNY                            │
├────────────────────────────────────────────────────────┤
│                                                        │
│  판매자 수령액: 9,600 CROWNY (96%)                      │
│                                                        │
│  수수료 분배:                                           │
│  ┌──────────────────────────────────────────────────┐  │
│  │ SUPER_ADMIN  ←── 50 CROWNY (0.5%)               │  │
│  │      ↑                                          │  │
│  │ CROWN        ←── 150 CROWNY (1.5%)              │  │
│  │      ↑                                          │  │
│  │ DIAMOND      ←── 100 CROWNY (1.0%)              │  │
│  │      ↑                                          │  │
│  │ GOLD         ←── 75 CROWNY (0.75%)              │  │
│  │      ↑                                          │  │
│  │ SILVER(추천인) ←── 25 CROWNY (0.25%)             │  │
│  │      ↑                                          │  │
│  │ 판매자(SILVER) ←── 9,600 CROWNY (96%)           │  │
│  └──────────────────────────────────────────────────┘  │
│                                                        │
└────────────────────────────────────────────────────────┘
```

### 4.3 수수료 지급 시점

- **에스크로 완료 후**: 구매자가 구매 확정 시 자동 분배
- **트랜잭션 원자성**: 모든 분배가 동시에 처리 (실패 시 전체 롤백)

---

## 5. 지갑 시스템

### 5.1 지갑 구조

```
┌─────────────────────────────────────────────────────────┐
│                    CROWNY 지갑                          │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  지갑 주소: CRW-XXXX-XXXX-XXXX-XXXX                     │
│                                                         │
│  ┌─────────────────────────────────────────────────┐   │
│  │  사용 가능 잔액 (balance)                        │   │
│  │  12,500.00 CROWNY                               │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
│  ┌─────────────────────────────────────────────────┐   │
│  │  거래 중 잔액 (pendingBalance)                   │   │
│  │  2,000.00 CROWNY                                │   │
│  │  * 에스크로 진행 중인 금액                        │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
│  ┌─────────────────────────────────────────────────┐   │
│  │  잠금 잔액 (lockedBalance)                       │   │
│  │  0.00 CROWNY                                    │   │
│  │  * 출금 대기 등 잠금된 금액                       │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

### 5.2 거래 유형

| 유형 | 코드 | 설명 | 잔액 변화 |
|-----|------|------|----------|
| 입금 | DEPOSIT | 외부에서 코인 입금 | balance + |
| 출금 | WITHDRAW | 외부로 코인 출금 | balance - |
| 구매 | PURCHASE | 상품 구매 | balance - |
| 판매 | SALE | 상품 판매 수익 | balance + |
| 수수료 | COMMISSION | 다단계 수수료 수령 | balance + |
| 송금 | TRANSFER | 회원간 직접 송금 | balance +/- |
| 에스크로 잠금 | ESCROW_LOCK | 거래 시작 시 잠금 | balance -, pending + |
| 에스크로 해제 | ESCROW_RELEASE | 거래 완료/취소 | pending -, balance + |

### 5.3 지갑 주소 체계

```
형식: CRW-[국가코드]-[난수8자리]-[체크섬4자리]
예시: CRW-KR-A1B2C3D4-E5F6
```

---

## 6. 마켓플레이스 기능

### 6.1 상품 등록

**등록 가능 등급**: SILVER 이상

**상품 정보 구조**:

| 필드 | 설명 | 필수 |
|-----|------|-----|
| 제목 | 상품명 (최대 100자) | O |
| 설명 | 상세 설명 (최대 5000자) | O |
| 이미지 | 최대 10장 | O (1장 이상) |
| 카테고리 | 상품 카테고리 | O |
| 상태 | 새상품/거의새것/양호/사용감있음 | O |
| 가격 | CROWNY 코인 | O |
| 가격협상 | 네고 가능 여부 | O |
| 거래방식 | 직거래/배송/둘다 | O |
| 위치 | 직거래 장소 | 직거래 시 필수 |
| 배송비 | 배송비용 | 배송 시 필수 |

### 6.2 상품 카테고리

```
📱 디지털/가전
   ├── 스마트폰
   ├── 태블릿
   ├── 노트북/PC
   ├── 카메라
   ├── 음향기기
   └── 기타 가전

👗 패션/의류
   ├── 남성의류
   ├── 여성의류
   ├── 신발
   ├── 가방
   ├── 시계/쥬얼리
   └── 액세서리

🏠 가구/인테리어
   ├── 가구
   ├── 침구
   ├── 주방용품
   └── 인테리어소품

🚗 자동차/오토바이
   ├── 자동차
   ├── 오토바이
   └── 자동차용품

📚 도서/티켓/문구
   ├── 도서
   ├── 티켓/쿠폰
   └── 문구/사무용품

🎮 게임/취미
   ├── 게임기/타이틀
   ├── 음반/악기
   ├── 피규어/장난감
   └── 수집품

👶 유아동
   ├── 유아의류
   ├── 유아용품
   └── 장난감/완구

🏃 스포츠/레저
   ├── 스포츠의류
   ├── 스포츠용품
   ├── 캠핑/아웃도어
   └── 자전거

🐕 반려동물
   ├── 용품
   └── 식품

🎁 기타
   └── 기타 상품
```

### 6.3 거래 흐름

```
┌─────────────────────────────────────────────────────────────┐
│                        거래 프로세스                         │
└─────────────────────────────────────────────────────────────┘

1. 상품 등록
   ┌─────────┐
   │ 판매자   │ ──→ 상품 정보 입력 ──→ 등록 완료 ──→ [ACTIVE]
   └─────────┘

2. 관심 표시 & 채팅
   ┌─────────┐      ┌─────────┐
   │ 구매자   │ ──→ │ 채팅방   │ ←── 판매자
   └─────────┘      └─────────┘
        │               │
        └── 가격 협의 ──┘

3. 구매 요청
   ┌─────────┐
   │ 구매자   │ ──→ [구매하기] 클릭 ──→ 주문 생성
   └─────────┘

4. 에스크로 결제
   ┌─────────────────────────────────────┐
   │ 구매자 지갑                          │
   │ balance: 15,000 → 5,000 (-10,000)  │
   │ pending: 0 → 0                      │
   └─────────────────────────────────────┘
                    │
                    ▼
   ┌─────────────────────────────────────┐
   │ 에스크로 계정                        │
   │ 주문금액: 10,000 CROWNY 잠금        │
   └─────────────────────────────────────┘

5. 거래 진행
   ┌──────────────────────────────────────────────┐
   │ 직거래:  만남 → 상품 확인 → 거래 완료 버튼    │
   │ 배송:    발송 → 배송중 → 수령 → 구매확정 버튼 │
   └──────────────────────────────────────────────┘

6. 거래 완료 & 수수료 분배
   ┌─────────────────────────────────────────────────────┐
   │ 에스크로 해제 & 자동 분배                            │
   │                                                     │
   │ 판매자    ←── 9,600 CROWNY (96%)                   │
   │ SILVER   ←── 25 CROWNY (0.25%)                     │
   │ GOLD     ←── 75 CROWNY (0.75%)                     │
   │ DIAMOND  ←── 100 CROWNY (1.0%)                     │
   │ CROWN    ←── 150 CROWNY (1.5%)                     │
   │ SUPER    ←── 50 CROWNY (0.5%)                      │
   └─────────────────────────────────────────────────────┘

7. 리뷰 작성
   ┌─────────┐      ┌─────────┐
   │ 구매자   │ ←→  │ 판매자   │   상호 평가
   └─────────┘      └─────────┘
```

### 6.4 주문 상태

| 상태 | 코드 | 설명 |
|-----|------|------|
| 결제 대기 | PENDING | 주문 생성됨, 결제 전 |
| 결제 완료 | PAID | 에스크로 잠금 완료 |
| 배송중 | SHIPPING | 판매자가 발송 |
| 배송 완료 | DELIVERED | 배송 완료 |
| 구매 확정 | CONFIRMED | 구매자 확인, 정산 완료 |
| 취소 | CANCELLED | 거래 취소 |
| 환불 | REFUNDED | 환불 처리 완료 |

---

## 7. 데이터베이스 설계

### 7.1 ERD 개요

```
┌──────────────┐     ┌──────────────┐     ┌──────────────┐
│    User      │────<│MemberRelation│>────│    User      │
│              │     │              │     │  (sponsor)   │
└──────────────┘     └──────────────┘     └──────────────┘
       │                    │
       │                    │
       ▼                    ▼
┌──────────────┐     ┌──────────────┐
│   Wallet     │     │   Product    │
│              │     │              │
└──────────────┘     └──────────────┘
       │                    │
       │                    │
       ▼                    ▼
┌──────────────┐     ┌──────────────┐
│ Transaction  │     │    Order     │
│              │     │              │
└──────────────┘     └──────────────┘
                           │
                           │
                           ▼
                    ┌──────────────┐
                    │  Commission  │
                    │              │
                    └──────────────┘
```

### 7.2 주요 테이블

#### User (기존 확장)
```sql
- id: String (PK)
- email: String (Unique)
- password: String
- name: String
- profileImage: String?
- phone: String?
- countryId: String (FK)
- createdAt: DateTime
- updatedAt: DateTime
```

#### MemberRelation (회원 관계)
```sql
- id: String (PK)
- memberId: String (FK, Unique) → User
- sponsorId: String? (FK) → User (추천인)
- grade: Enum (SUPER_ADMIN, CROWN, DIAMOND, GOLD, SILVER, BRONZE)
- gradeGrantedBy: String? (FK) → User (등급 부여자)
- gradeGrantedAt: DateTime?
- countryId: String? (FK) → Country
- createdAt: DateTime
```

#### Wallet (지갑)
```sql
- id: String (PK)
- userId: String (FK, Unique) → User
- walletAddress: String (Unique)
- balance: BigInt (사용 가능)
- pendingBalance: BigInt (거래 중)
- lockedBalance: BigInt (잠금)
- createdAt: DateTime
- updatedAt: DateTime
```

#### Transaction (거래 내역)
```sql
- id: String (PK)
- walletId: String (FK) → Wallet
- type: Enum (DEPOSIT, WITHDRAW, PURCHASE, SALE, COMMISSION, TRANSFER, ESCROW_LOCK, ESCROW_RELEASE)
- amount: BigInt
- fee: BigInt
- description: String?
- referenceId: String? (관련 주문 ID)
- status: Enum (PENDING, COMPLETED, FAILED, CANCELLED)
- createdAt: DateTime
```

#### Product (상품)
```sql
- id: String (PK)
- sellerId: String (FK) → User
- title: String
- description: String
- images: String[] (URL 배열)
- categoryId: String (FK) → ProductCategory
- condition: Enum (NEW, LIKE_NEW, GOOD, FAIR)
- price: BigInt
- negotiable: Boolean
- shippingType: Enum (DIRECT, DELIVERY, BOTH)
- shippingFee: BigInt?
- locationLat: Float?
- locationLng: Float?
- locationAddr: String?
- status: Enum (DRAFT, ACTIVE, RESERVED, SOLD, HIDDEN)
- viewCount: Int
- likeCount: Int
- createdAt: DateTime
- updatedAt: DateTime
```

#### ProductCategory (카테고리)
```sql
- id: String (PK)
- name: String
- nameEn: String
- icon: String?
- parentId: String? (FK, 자기참조)
- sortOrder: Int
```

#### Order (주문)
```sql
- id: String (PK)
- orderNumber: String (Unique)
- buyerId: String (FK) → User
- sellerId: String (FK) → User
- productId: String (FK) → Product
- amount: BigInt
- shippingFee: BigInt
- totalAmount: BigInt
- status: Enum (PENDING, PAID, SHIPPING, DELIVERED, CONFIRMED, CANCELLED, REFUNDED)
- shippingType: Enum
- shippingAddress: String?
- trackingNumber: String?
- createdAt: DateTime
- updatedAt: DateTime
- completedAt: DateTime?
```

#### Commission (수수료)
```sql
- id: String (PK)
- orderId: String (FK) → Order
- userId: String (FK) → User
- grade: Enum (MarketGrade)
- rate: Float (수수료율)
- amount: BigInt
- status: Enum (PENDING, PAID, CANCELLED)
- createdAt: DateTime
- paidAt: DateTime?
```

#### ChatRoom (채팅방)
```sql
- id: String (PK)
- productId: String (FK) → Product
- buyerId: String (FK) → User
- sellerId: String (FK) → User
- lastMessageAt: DateTime?
- createdAt: DateTime
```

#### ChatMessage (채팅 메시지)
```sql
- id: String (PK)
- roomId: String (FK) → ChatRoom
- senderId: String (FK) → User
- content: String
- imageUrl: String?
- isRead: Boolean
- createdAt: DateTime
```

#### Review (리뷰)
```sql
- id: String (PK)
- orderId: String (FK, Unique) → Order
- reviewerId: String (FK) → User
- revieweeId: String (FK) → User
- rating: Int (1-5)
- content: String?
- createdAt: DateTime
```

---

## 8. 화면 설계

### 8.1 앱 네비게이션 구조

```
┌─────────────────────────────────────────────────────────────┐
│                      CROWNY 마켓                            │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │                                                     │   │
│  │                    메인 콘텐츠                       │   │
│  │                                                     │   │
│  │                                                     │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│  [🏠홈]    [🔍검색]    [➕등록]    [💬채팅]    [👤MY]        │
└─────────────────────────────────────────────────────────────┘
```

### 8.2 주요 화면 목록

#### 인증
- 로그인
- 회원가입
- 비밀번호 찾기

#### 홈
- 메인 피드 (상품 목록)
- 배너 (이벤트/공지)
- 카테고리 바로가기
- 내 주변 상품

#### 검색
- 검색 입력
- 검색 결과
- 필터/정렬
- 인기 검색어

#### 상품
- 상품 등록
- 상품 상세
- 상품 수정

#### 채팅
- 채팅 목록
- 채팅방

#### 마이페이지
- 프로필
- 내 지갑
- 판매 내역
- 구매 내역
- 관심 목록
- 내 조직 (추천 트리)
- 수수료 내역
- 설정

#### 관리자 (등급별)
- 회원 관리
- 등급 부여
- 통계 대시보드

### 8.3 상품 상세 화면

```
┌─────────────────────────────────────────────────────────────┐
│ ←  상품 상세                                    ♡     ⋮    │
├─────────────────────────────────────────────────────────────┤
│ ┌─────────────────────────────────────────────────────────┐ │
│ │                                                         │ │
│ │                                                         │ │
│ │                    상품 이미지                           │ │
│ │                   (스와이프 가능)                        │ │
│ │                                                         │ │
│ │                                                         │ │
│ └─────────────────────────────────────────────────────────┘ │
│                     ● ○ ○ ○ ○                              │
├─────────────────────────────────────────────────────────────┤
│ ┌─────────┐                                                │
│ │ 프로필   │  닉네임              ★ 4.8                    │
│ │ 이미지   │  🟡 GOLD 등급        팔로워 128               │
│ └─────────┘                                                │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  아이폰 15 Pro 256GB 팝니다                                 │
│                                                             │
│  💰 15,000 CROWNY                                          │
│                                                             │
│  📍 서울 강남구 · 3시간 전                                  │
│  👁 조회 42  ·  ♡ 찜 5  ·  💬 채팅 3                       │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│ 상품 정보                                                   │
│                                                             │
│ 상태: 거의 새것                                             │
│ 거래 방법: 직거래, 배송 가능                                 │
│ 배송비: 3,000 CROWNY                                       │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│ 상품 설명                                                   │
│                                                             │
│ 2개월 사용한 아이폰입니다.                                   │
│ 액정 기스 없고 케이스 항상 사용했습니다.                      │
│ 풀박스이고 충전기, 케이블 모두 포함입니다.                    │
│ 직거래 강남역 선호합니다.                                    │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌───────────────────┐  ┌───────────────────┐              │
│  │    💬 채팅하기     │  │    🛒 구매하기     │              │
│  └───────────────────┘  └───────────────────┘              │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 8.4 내 지갑 화면

```
┌─────────────────────────────────────────────────────────────┐
│ ←  내 지갑                                                  │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│              ┌─────────────────────────────┐                │
│              │      💰 CROWNY 지갑         │                │
│              │                             │                │
│              │     12,500.00               │                │
│              │       CROWNY                │                │
│              │                             │                │
│              │      ≈ $1,250 USD           │                │
│              └─────────────────────────────┘                │
│                                                             │
│         [입금]      [출금]      [송금]                       │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│ 📊 자산 현황                                                │
│                                                             │
│ 사용 가능     ████████████████░░░░  12,500 CROWNY          │
│ 거래 중       ████░░░░░░░░░░░░░░░░   2,000 CROWNY          │
│ 출금 대기     ░░░░░░░░░░░░░░░░░░░░       0 CROWNY          │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│ 📋 최근 거래                                                │
│                                                             │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ 수수료 수익                           +50 CROWNY        │ │
│ │ 2026.02.03 14:30 · 판매 수수료                         │ │
│ └─────────────────────────────────────────────────────────┘ │
│                                                             │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ 상품 판매                          +5,000 CROWNY        │ │
│ │ 2026.02.03 14:30 · 아이폰 케이스                        │ │
│ └─────────────────────────────────────────────────────────┘ │
│                                                             │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ 상품 구매                          -2,000 CROWNY        │ │
│ │ 2026.02.02 09:20 · 갤럭시 버즈                          │ │
│ └─────────────────────────────────────────────────────────┘ │
│                                                             │
│                    [전체 내역 보기 →]                        │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 9. API 설계

### 9.1 API 엔드포인트 목록

#### 인증 (Auth)
| Method | Endpoint | 설명 |
|--------|----------|------|
| POST | /api/auth/register | 회원가입 |
| POST | /api/auth/login | 로그인 |
| POST | /api/auth/logout | 로그아웃 |
| POST | /api/auth/refresh | 토큰 갱신 |
| POST | /api/auth/forgot-password | 비밀번호 찾기 |

#### 지갑 (Wallet)
| Method | Endpoint | 설명 |
|--------|----------|------|
| GET | /api/wallet | 내 지갑 조회 |
| GET | /api/wallet/transactions | 거래 내역 |
| POST | /api/wallet/deposit | 입금 요청 |
| POST | /api/wallet/withdraw | 출금 요청 |
| POST | /api/wallet/transfer | 회원간 송금 |

#### 상품 (Products)
| Method | Endpoint | 설명 |
|--------|----------|------|
| GET | /api/products | 상품 목록 (필터/검색) |
| GET | /api/products/:id | 상품 상세 |
| POST | /api/products | 상품 등록 |
| PUT | /api/products/:id | 상품 수정 |
| DELETE | /api/products/:id | 상품 삭제 |
| POST | /api/products/:id/like | 찜하기/취소 |
| GET | /api/products/categories | 카테고리 목록 |

#### 주문 (Orders)
| Method | Endpoint | 설명 |
|--------|----------|------|
| POST | /api/orders | 주문 생성 |
| GET | /api/orders | 내 주문 목록 |
| GET | /api/orders/:id | 주문 상세 |
| PUT | /api/orders/:id/pay | 결제 (에스크로) |
| PUT | /api/orders/:id/ship | 배송 시작 |
| PUT | /api/orders/:id/confirm | 구매 확정 |
| PUT | /api/orders/:id/cancel | 주문 취소 |

#### 채팅 (Chats)
| Method | Endpoint | 설명 |
|--------|----------|------|
| GET | /api/chats | 채팅방 목록 |
| POST | /api/chats/room | 채팅방 생성 |
| GET | /api/chats/:roomId | 메시지 목록 |
| POST | /api/chats/:roomId | 메시지 전송 |
| WebSocket | /ws/chat | 실시간 채팅 |

#### 회원/등급 (Members)
| Method | Endpoint | 설명 |
|--------|----------|------|
| GET | /api/members/me | 내 정보 |
| GET | /api/members/:id | 회원 프로필 |
| GET | /api/members/tree | 내 추천 트리 |
| POST | /api/members/grant-grade | 등급 부여 |
| GET | /api/members/commissions | 수수료 내역 |
| GET | /api/members/subordinates | 산하 회원 목록 |

#### 리뷰 (Reviews)
| Method | Endpoint | 설명 |
|--------|----------|------|
| POST | /api/reviews | 리뷰 작성 |
| GET | /api/reviews/user/:userId | 회원 리뷰 |

#### 관리자 (Admin)
| Method | Endpoint | 설명 |
|--------|----------|------|
| GET | /api/admin/dashboard | 대시보드 통계 |
| GET | /api/admin/members | 회원 관리 |
| PUT | /api/admin/members/:id/grade | 등급 변경 |
| GET | /api/admin/orders | 주문 관리 |
| GET | /api/admin/products | 상품 관리 |

### 9.2 API 응답 형식

```json
{
  "success": true,
  "data": { ... },
  "message": "성공 메시지",
  "meta": {
    "page": 1,
    "limit": 20,
    "total": 100,
    "totalPages": 5
  }
}
```

### 9.3 에러 응답 형식

```json
{
  "success": false,
  "error": {
    "code": "INSUFFICIENT_BALANCE",
    "message": "잔액이 부족합니다.",
    "details": {
      "required": 10000,
      "available": 5000
    }
  }
}
```

---

## 10. 글로벌 운영 전략

### 10.1 다국가 지원

```
┌─────────────────────────────────────────────────────────────┐
│                     글로벌 운영 구조                         │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│                    SUPER_ADMIN (본사)                       │
│                          │                                  │
│          ┌───────────────┼───────────────┐                  │
│          │               │               │                  │
│          ▼               ▼               ▼                  │
│     CROWN (KR)      CROWN (US)      CROWN (JP)             │
│     한국 총괄        미국 총괄        일본 총괄              │
│          │               │               │                  │
│          ▼               ▼               ▼                  │
│     DIAMOND         DIAMOND         DIAMOND                 │
│     서울/부산       NY/LA           도쿄/오사카             │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 10.2 다국어 지원 (i18n)

| 언어 | 코드 | 우선순위 |
|-----|------|---------|
| 한국어 | ko | 1차 |
| 영어 | en | 2차 |
| 일본어 | ja | 3차 |
| 중국어 (간체) | zh-CN | 4차 |
| 스페인어 | es | 5차 |

### 10.3 시간대 처리

- **서버**: UTC 기준 저장
- **클라이언트**: 사용자 로컬 시간대로 변환 표시
- **거래 기록**: UTC + 사용자 시간대 병기

### 10.4 통화 표시

- **기본 단위**: CROWNY 코인
- **참고 환율**: 주요 통화(USD, KRW, JPY, EUR) 실시간 표시
- **환율 API**: 외부 환율 API 연동

### 10.5 국가별 규제 대응

| 항목 | 대응 방안 |
|-----|----------|
| 이용약관 | 국가별 법률에 맞는 약관 |
| 개인정보 | GDPR, 개인정보보호법 준수 |
| 세금 | 국가별 세금 안내 (사용자 책임 명시) |
| 연령 제한 | 국가별 최소 이용 연령 적용 |

---

## 11. 기술 스택

### 11.1 프론트엔드

| 기술 | 버전 | 용도 |
|-----|------|------|
| Next.js | 16.x | 웹 프레임워크 |
| React | 19.x | UI 라이브러리 |
| TypeScript | 5.x | 타입 안정성 |
| Tailwind CSS | 4.x | 스타일링 |
| React Native | 0.73+ | 모바일 앱 |
| Expo | 50+ | 모바일 개발 도구 |

### 11.2 백엔드

| 기술 | 버전 | 용도 |
|-----|------|------|
| Next.js API Routes | 16.x | API 서버 |
| Prisma | 5.x | ORM |
| PostgreSQL | 15+ | 데이터베이스 |
| NextAuth.js | 4.x | 인증 |
| Socket.io | 4.x | 실시간 통신 |

### 11.3 인프라

| 기술 | 용도 |
|-----|------|
| AWS S3 / Cloudinary | 이미지 저장 |
| Redis | 세션/캐시 |
| Firebase FCM | 푸시 알림 |
| Vercel / AWS | 호스팅 |

### 11.4 개발 도구

| 도구 | 용도 |
|-----|------|
| ESLint | 코드 품질 |
| Prettier | 코드 포맷팅 |
| Jest | 테스트 |
| GitHub Actions | CI/CD |

---

## 12. 구현 로드맵

### Phase 1: 기반 구축 (1-2주)

- [ ] 데이터베이스 스키마 설계 및 마이그레이션
- [ ] 회원 등급 시스템 (6단계)
- [ ] 권한 부여 시스템
- [ ] 지갑 시스템 기본 구현
- [ ] 기본 API 구조

### Phase 2: 마켓 핵심 (3-4주)

- [ ] 상품 CRUD API
- [ ] 상품 검색/필터
- [ ] 이미지 업로드
- [ ] 카테고리 관리
- [ ] 상품 목록/상세 UI

### Phase 3: 거래 시스템 (5-6주)

- [ ] 주문 생성/관리
- [ ] 에스크로 결제 시스템
- [ ] 다단계 수수료 분배 로직
- [ ] 거래 상태 관리
- [ ] 주문 내역 UI

### Phase 4: 소셜 기능 (7-8주)

- [ ] 실시간 채팅 (WebSocket)
- [ ] 알림 시스템
- [ ] 리뷰/평점 시스템
- [ ] 찜 목록
- [ ] 회원 프로필

### Phase 5: 모바일 최적화 (9-10주)

- [ ] 반응형 UI 완성
- [ ] PWA 설정
- [ ] 푸시 알림
- [ ] 위치 기반 서비스
- [ ] React Native 앱 개발

### Phase 6: 고도화 (11-12주)

- [ ] 관리자 대시보드
- [ ] 통계/리포트
- [ ] 다국어 지원 (i18n)
- [ ] 보안 강화
- [ ] 성능 최적화

---

## 13. 보안 고려사항

### 13.1 거래 보안

| 항목 | 대책 |
|-----|------|
| 에스크로 | 모든 거래는 에스크로 시스템으로 보호 |
| 잔액 검증 | 거래 전 실시간 잔액 확인 |
| 트랜잭션 | 수수료 분배 원자성 보장 (전체 성공/전체 실패) |
| 중복 방지 | 이중 결제 방지 로직 |

### 13.2 인증 보안

| 항목 | 대책 |
|-----|------|
| 비밀번호 | bcrypt 해싱 (salt rounds: 12) |
| 세션 | JWT + Refresh Token |
| 2FA | OTP 인증 지원 (선택) |
| 로그인 시도 | 5회 실패 시 계정 잠금 |

### 13.3 데이터 보안

| 항목 | 대책 |
|-----|------|
| 전송 | HTTPS 필수 |
| 저장 | 민감 정보 암호화 |
| 채팅 | 종단간 암호화 (E2E) |
| 백업 | 일일 자동 백업 |

### 13.4 API 보안

| 항목 | 대책 |
|-----|------|
| Rate Limiting | IP/사용자별 요청 제한 |
| 권한 검증 | 모든 API에 등급 검증 |
| 입력 검증 | SQL Injection, XSS 방지 |
| CORS | 허용 도메인만 접근 |

### 13.5 이미지 보안

| 항목 | 대책 |
|-----|------|
| 업로드 | 파일 타입/크기 제한 |
| 악성코드 | 이미지 스캔 |
| 저장 | CDN + 서명된 URL |

---

## 부록

### A. 용어 정의

| 용어 | 정의 |
|-----|------|
| CROWNY 코인 | 플랫폼 내 거래에 사용되는 디지털 자산 |
| 에스크로 | 거래 완료까지 결제 금액을 안전하게 보관하는 시스템 |
| 추천인 | 회원 가입 시 초대한 상위 회원 |
| 산하 회원 | 자신이 초대하거나 관리하는 하위 회원 |
| 수수료 분배 | 거래 발생 시 상위 라인으로 수수료가 분배되는 구조 |

### B. 에러 코드 목록

| 코드 | 설명 |
|-----|------|
| AUTH_REQUIRED | 로그인 필요 |
| PERMISSION_DENIED | 권한 없음 |
| INSUFFICIENT_BALANCE | 잔액 부족 |
| PRODUCT_NOT_FOUND | 상품 없음 |
| ORDER_NOT_FOUND | 주문 없음 |
| INVALID_GRADE | 잘못된 등급 |
| GRADE_GRANT_DENIED | 등급 부여 권한 없음 |

---

**문서 끝**

*이 문서는 CROWNY 코인 마켓플레이스 개발을 위한 기획서입니다.*
*실제 구현 시 요구사항에 따라 변경될 수 있습니다.*
